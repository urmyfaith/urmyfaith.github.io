<!DOCTYPE HTML>
<html>
<head>
<!--百度轻应用-->
    <script type="text/javascript" name="baidu-tc-cerfication" data-appid="5027706" src="http://apps.bdimg.com/cloudaapi/lightapp.js"></script>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta name="description" content="z2ex">
  <meta name="author" content="z2xy">
  <meta name="keywords" content="单例设计模式, z2xy, z2xy">
  <title>单例设计模式 - z2xy</title>
  <link rel="canonical" href="http://5i01314.vipsinaapp.com//blog/2014/10/20/Design_pattern_Singleton.html">
  <link rel="icon" id="icon"  href="/res/img/icon/1.ico" type="image/x-icon">
  <link rel="shortcut icon" id="shortcut_icon" href="/res/img/icon/1.ico" type="image/x-icon">
  <link rel="stylesheet" href="/res/css/public.css">
  <link rel="stylesheet" href="/res/css/light.css">


  

  <script src="/res/js/light.js"></script>
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>
</head>
<body>
  <div id="blog">
    <div class="sidebar">
  <div class="profilepic">
    <a href="/"><img src="/res/img/icon.jpg" alt="logo"></img></a>
  </div>
  <h1 class="title" ><a href="/" ><font id="change">z2xy</font></a></h1>
  <h2 class="sub-title" >The time is passing</h2>
  <nav id="nav">
    <ul>
    
      <li><a href="/page/timing.html"><i class="fa fa-clock-o"></i>&nbsp;时间穿梭</a></li>
    
      <li><a href="/page/category.html"><i class="fa fa-tags"></i>&nbsp;文章分类</a></li>
    
      <li><a href="/page/resource.html"><i class="fa fa-book"></i>&nbsp;资源收藏</a></li>
    
      <li><a href="/page/about.html"><i class="fa fa-star"></i>&nbsp;关于作者</a></li>
    
    </ul>
  </nav>  
  <nav id="sub-nav">
    <a class="weibo " href="http://weibo.com/autumn_0528" title="新浪微博" target="_blank"><i class="fa fa-weibo"></i></a>
    <a class="github" href="https://github.com/urmyfaith" title="GitHub" target="_blank"><i class="fa fa-github fa-2x"></i></a>
    <a class="rss" href="/page/feed.xml" title="RSS订阅" target="_blank"><i class="fa fa-rss"></i></a>
  </nav>
  <div id="license">
    <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" target="_blank" title="本站所有作品采用：&#10;知识共享《署名 非商业性使用 相同方式共享 3.0》&#10;进行许可" >
    <img alt="License" height="31" width="88" src="/res/img/license.png" /></a>
  </div>
</div>



   <script>
    window.self.setInterval("reviseColor()",10000);
    function reviseColor(){
	var dom = window.document;
	var f = dom.getElementById("change");
	("white"==f.style.color) ? (f.style.color = "red") : (("red" == f.style.color) ? (f.style.color = "green") :  ("green" == f.style.color)?f.style.color = "blue":(f.style.color = "white"));

	}
   </script>
    <div class="main">
    <header class="post-header">
  <h1 class="post-title"><a href="/blog/2014/10/20/Design_pattern_Singleton.html">单例设计模式</a></h2>
  <p class="post-meta">
    <i class="fa fa-calendar"></i>
    2014年10月20日
    <i class="space"></i>
    <i class="fa fa-tag"></i>
    <a class="post-category" href="/page/category.html#设计模式">设计模式</a>
	<br />
	<i class="fa fa-tags"></i>
	<a class="post-category" href="/page/tags.html#设计模式">设计模式</a><i class="space"></i><a class="post-category" href="/page/tags.html#单例设计模式">单例设计模式</a><i class="space"></i><a class="post-category" href="/page/tags.html#Singleton">Singleton</a><i class="space"></i><a class="post-category" href="/page/tags.html#饿汉式">饿汉式</a><i class="space"></i><a class="post-category" href="/page/tags.html#懒汉式">懒汉式</a><i class="space"></i><a class="post-category" href="/page/tags.html#Double-checked locking">Double-checked locking</a><i class="space"></i><a class="post-category" href="/page/tags.html#双重检查锁定">双重检查锁定</a><i class="space"></i>
  </p>
</header>
<div class="post-main">
<h2 id="section">单例设计模式</h2>

<p><strong>意图</strong></p>

<pre><code>保证一个类仅有一个实例，并提供一个访问它的全局访问点。
</code></pre>

<p><strong>适用性</strong></p>

<pre><code>当类只能有一个实例而且客户可以从一个众所周知的访问点访问它时。
当这个唯一实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时。
</code></pre>

<!-- more -->

<p><strong>单例的设计模式</strong></p>

<pre><code>问题：可以通过new关键字调用构造函数对类的对象进行初始化	
	单例中如果解决了无法对创建的对象进行初始化，那么就不会将对象赋值给引用变量。
	(保持对象的唯一性)
</code></pre>

<p><strong>单例的实现步骤</strong></p>

<pre><code>私有化构造函数 ， 禁止直接通过构造函数创建实例
在类中自定义一个对象
对外提供该对象的公共访问方式
</code></pre>

<p><strong>单例的一般实现有两中模式</strong></p>

<blockquote>
  <ol>
    <li><code>饿汉式</code>  指全局的单例实例在类装载时构建。(存在对象生命周期过长问题)    </li>
    <li><code>懒汉式</code>  指全局的单例实例在第一次被使用时构建。(存在线程安全问题,使用锁后推荐使用)     </li>
    <li><code>内部类</code>  </li>
    <li><code>枚举</code>  </li>
  </ol>
</blockquote>

<p>例:</p>

<p><strong>饿汉式</strong></p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonHungry</span><span class="o">{</span>	<span class="c1">//饿汉式</span>
	<span class="c1">// 1. 提供显示的私有的构造函数</span>
	<span class="kd">private</span> <span class="nf">SingletonHungry</span><span class="o">(){}</span>
	<span class="c1">// 2. 定义一个该类的引用变量并调用构造函数初始化非静态成员属性</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="n">SingletonHungry</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SingletonHungry</span><span class="o">();</span>  <span class="c1">//饿汉式单例</span>
	<span class="c1">// 3. 对单例的对象进行封装</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="n">SingletonHungry</span> <span class="nf">getInstance</span><span class="o">(){</span>
	  <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="c1">// 提供服务</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getService</span><span class="o">(){</span>
	   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">&quot;提供服务........&quot;</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<hr />

<p><strong>懒汉式</strong></p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonLazy1</span><span class="o">{</span> <span class="c1">//懒汉式 _ 双重检查锁定</span>
	<span class="c1">// 1. 提供显示的私有的构造函数</span>
	<span class="kd">private</span> <span class="nf">SingletonLazy1</span><span class="o">(){}</span>
	<span class="c1">// 2. 定义一个该类的引用变量并调用构造函数初始化   非静态成员属性</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="n">SingletonLazy1</span> <span class="n">instance</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>  <span class="c1">// 懒汉式单例</span>
	<span class="c1">// 3. 对单例的对象进行封装</span>
	<span class="kd">public</span>  <span class="kd">static</span> <span class="n">SingletonLazy1</span> <span class="nf">getInstance</span><span class="o">(){</span>	<span class="c1">//需要用到的时候进行调用</span>
		<span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">){</span><span class="c1">//查看是否有实例,有则直接返回</span>
			<span class="kd">synchronized</span><span class="o">(</span><span class="n">SingletonLazy1</span><span class="o">.</span><span class="na">class</span> <span class="o">){</span><span class="c1">//多线程操作,有可能会出现多个线程同时必发范围_加锁.</span>
				<span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">){</span>
					<span class="kd">synchronized</span><span class="o">(</span><span class="n">SingletonLazy1</span><span class="o">.</span><span class="na">class</span> <span class="o">){</span>	<span class="c1">//线程同步</span>
						<span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
							<span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SingletonLazy1</span> <span class="o">();</span>
						<span class="o">}</span>
					<span class="o">}</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	  <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="c1">// 提供服务</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getService</span><span class="o">(){</span>
	   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">&quot;提供服务........&quot;</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<hr />

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonLazy2</span><span class="o">{</span>  <span class="c1">// 双重检查锁定 </span>
	<span class="c1">//注意在JDK1.4以及更早版本的Java中许多JVM对于 volatile 关键字的实现会导致双重检查加锁失效,此种方法只能用在JDK5及以后版本</span>
	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kd">static</span> <span class="n">SingletonLazy2</span> <span class="n">UNIQUE_INSTANCE</span><span class="o">;</span> <span class="c1">//注意 volatile 关键字</span>

	<span class="kd">private</span> <span class="nf">SingletonLazy2</span><span class="o">(){}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="n">SingletonLazy2</span> <span class="nf">getInstance</span><span class="o">(){</span>
		<span class="k">if</span><span class="o">(</span><span class="n">UNIQUE_INSTANCE</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
			<span class="kd">synchronized</span><span class="o">(</span><span class="n">SingletonLazy2</span><span class="o">.</span><span class="na">class</span><span class="o">){</span>
				<span class="k">if</span><span class="o">(</span><span class="n">UNIQUE_INSTANCE</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
					<span class="n">UNIQUE_INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SingletonLazy2</span><span class="o">();</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">UNIQUE_INSTANCE</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<hr />

<p><strong>内部类</strong></p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonInnerClass</span> <span class="o">{</span>  <span class="c1">//内部类</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SingletonHolder</span> <span class="o">{</span>  
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">SingletonInnerClass</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SingletonInnerClass</span><span class="o">();</span>  
    <span class="o">}</span>  
    <span class="kd">private</span> <span class="nf">SingletonInnerClass</span> <span class="o">(){}</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">SingletonInnerClass</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>  
	 <span class="k">return</span> <span class="n">SingletonHolder</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>  
    <span class="o">}</span>  
<span class="o">}</span></code></pre></div>

<hr />

<p><strong>枚举</strong></p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">SingletonEnum</span> <span class="o">{</span>   <span class="c1">//枚举</span>
    <span class="n">INSTANCE</span><span class="o">;</span>  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">whateverMethod</span><span class="o">()</span> <span class="o">{</span>  
    <span class="o">}</span>  
<span class="o">}</span></code></pre></div>

<hr />

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Demo</span> <span class="o">{</span> <span class="c1">//调用测试</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SingletonLazy2</span> <span class="n">s1</span> <span class="o">=</span>  <span class="n">SingletonLazy2</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
		<span class="n">SingletonLazy2</span> <span class="n">s2</span> <span class="o">=</span>  <span class="n">SingletonLazy2</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span> <span class="o">);</span>
	
		

		<span class="n">SingletonEnum</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">whateverMethod</span><span class="o">();</span><span class="c1">//枚举</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p><strong>参考文档链接</strong></p>

<p><a href="http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html">“双重检查锁定”会发生非预期行为声明</a></p>

<p><a href="http://blog.csdn.net/haoel/article/details/4028232">深入浅出单实例Singleton设计模式</a></p>

<p><a href="http://cantellow.iteye.com/blog/838473">单例模式的七种写法</a></p>

<p><a href="http://blog.csdn.net/java2000_net/article/details/3983958#">枚举增强单例模式的可靠性</a></p>

</div>
<div class="share">
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
  </div>
  <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":["qzone","tsina","weixin","sqq"],"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/res/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</div>
<div class="pagination">

<a class="pagination-item newer" href="/blog/2014/10/19/git_common_command.html"><i class="fa fa-arrow-left"></i>&nbsp;&nbsp;Git 常用命令整理</a>


<a class="pagination-item older" href="/blog/2014/10/20/Design_pattern_Template.html">模板设计模式&nbsp;&nbsp;<i class="fa fa-arrow-right"></i></a>

</div>
<style>#ds-reset .ds-avatar img{border-radius:50%;}</style>
<div class="comments">
  <div class="ds-thread" data-title="单例设计模式" data-thread-key="/blog/2014/10/20/Design_pattern_Singleton" data-url="http://5i01314.vipsinaapp.com//blog/2014/10/20/Design_pattern_Singleton.html"></div>
  <script type="text/javascript">var duoshuoQuery = {short_name:""};(function(){var ds = document.createElement('script');ds.type = 'text/javascript';ds.async = true;ds.src = '/res/js/embed.js';ds.charset = 'UTF-8';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);})();</script>
</div>
    <footer>Copyright&nbsp;&copy;&nbsp;2015 <a href="http://5i01314.vipsinaapp.com/">z2xy</a><br/><i class="fa fa-cogs" style="color:blueviolet;">&nbsp;</i>Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a></footer>
    </div>
  </div>    
  <div id="top"><a id="rocket" href="javascript:;" title="返回顶部"><i></i></a></div>
  
</body>
</html>
